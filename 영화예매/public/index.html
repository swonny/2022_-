 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <ul id="0">
        <li class="0" onclick="clickSeat(this)"></li>
        <li class="1" onclick="clickSeat(this)"></li>
        <li class="2" onclick="clickSeat(this)"></li>
        <li class="3" onclick="clickSeat(this)"></li>
        <li class="4" onclick="clickSeat(this)"></li>
        <li class="5" onclick="clickSeat(this)"></li>
        <li class="6" onclick="clickSeat(this)"></li>
        <li class="7" onclick="clickSeat(this)"></li>
        <li class="8" onclick="clickSeat(this)"></li>
        <li class="9" onclick="clickSeat(this)"></li>
        <li class="10" onclick="clickSeat(this)"></li>
        <li class="11" onclick="clickSeat(this)"></li>
        <li class="12" onclick="clickSeat(this)"></li>
        <li class="13" onclick="clickSeat(this)"></li>
    </ul>
    <ul id="1">
        <li class="0" onclick="clickSeat(this)"></li>
        <li class="1" onclick="clickSeat(this)"></li>
        <li class="2" onclick="clickSeat(this)"></li>
        <li class="3" onclick="clickSeat(this)"></li>
        <li class="4" onclick="clickSeat(this)"></li>
        <li class="5" onclick="clickSeat(this)"></li>
        <li class="6" onclick="clickSeat(this)"></li>
        <li class="7" onclick="clickSeat(this)"></li>
        <li class="8" onclick="clickSeat(this)"></li>
        <li class="9" onclick="clickSeat(this)"></li>
        <li class="10" onclick="clickSeat(this)"></li>
        <li class="11" onclick="clickSeat(this)"></li>
        <li class="12" onclick="clickSeat(this)"></li>
        <li class="13" onclick="clickSeat(this)"></li>
    </ul>
    <ul id="2">
        <li class="0" onclick="clickSeat(this)"></li>
        <li class="1" onclick="clickSeat(this)"></li>
        <li class="2" onclick="clickSeat(this)"></li>
        <li class="3" onclick="clickSeat(this)"></li>
        <li class="4" onclick="clickSeat(this)"></li>
        <li class="5" onclick="clickSeat(this)"></li>
        <li class="6" onclick="clickSeat(this)"></li>
        <li class="7" onclick="clickSeat(this)"></li>
        <li class="8" onclick="clickSeat(this)"></li>
        <li class="9" onclick="clickSeat(this)"></li>
        <li class="10" onclick="clickSeat(this)"></li>
        <li class="11" onclick="clickSeat(this)"></li>
        <li class="12" onclick="clickSeat(this)"></li>
        <li class="13" onclick="clickSeat(this)"></li>
    </ul>
    <ul id="3">
        <li class="0" onclick="clickSeat(this)"></li>
        <li class="1" onclick="clickSeat(this)"></li>
        <li class="2" onclick="clickSeat(this)"></li>
        <li class="3" onclick="clickSeat(this)"></li>
        <li class="4" onclick="clickSeat(this)"></li>
        <li class="5" onclick="clickSeat(this)"></li>
        <li class="6" onclick="clickSeat(this)"></li>
        <li class="7" onclick="clickSeat(this)"></li>
        <li class="8" onclick="clickSeat(this)"></li>
        <li class="9" onclick="clickSeat(this)"></li>
        <li class="10" onclick="clickSeat(this)"></li>
        <li class="11" onclick="clickSeat(this)"></li>
        <li class="12" onclick="clickSeat(this)"></li>
        <li class="13" onclick="clickSeat(this)"></li>
    </ul>
    <ul id="4">
        <li class="0" onclick="clickSeat(this)"></li>
        <li class="1" onclick="clickSeat(this)"></li>
        <li class="2" onclick="clickSeat(this)"></li>
        <li class="3" onclick="clickSeat(this)"></li>
        <li class="4" onclick="clickSeat(this)"></li>
        <li class="5" onclick="clickSeat(this)"></li>
        <li class="6" onclick="clickSeat(this)"></li>
        <li class="7" onclick="clickSeat(this)"></li>
        <li class="8" onclick="clickSeat(this)"></li>
        <li class="9" onclick="clickSeat(this)"></li>
        <li class="10" onclick="clickSeat(this)"></li>
        <li class="11" onclick="clickSeat(this)"></li>
        <li class="12" onclick="clickSeat(this)"></li>
        <li class="13" onclick="clickSeat(this)"></li>
    </ul>
    <ul id="5">
        <li class="0" onclick="clickSeat(this)"></li>
        <li class="1" onclick="clickSeat(this)"></li>
        <li class="2" onclick="clickSeat(this)"></li>
        <li class="3" onclick="clickSeat(this)"></li>
        <li class="4" onclick="clickSeat(this)"></li>
        <li class="5" onclick="clickSeat(this)"></li>
        <li class="6" onclick="clickSeat(this)"></li>
        <li class="7" onclick="clickSeat(this)"></li>
        <li class="8" onclick="clickSeat(this)"></li>
        <li class="9" onclick="clickSeat(this)"></li>
        <li class="10" onclick="clickSeat(this)"></li>
        <li class="11" onclick="clickSeat(this)"></li>
        <li class="12" onclick="clickSeat(this)"></li>
        <li class="13" onclick="clickSeat(this)"></li>
    </ul>
    <ul id="6">
        <li class="0" onclick="clickSeat(this)"></li>
        <li class="1" onclick="clickSeat(this)"></li>
        <li class="2" onclick="clickSeat(this)"></li>
        <li class="3" onclick="clickSeat(this)"></li>
        <li class="4" onclick="clickSeat(this)"></li>
        <li class="5" onclick="clickSeat(this)"></li>
        <li class="6" onclick="clickSeat(this)"></li>
        <li class="7" onclick="clickSeat(this)"></li>
        <li class="8" onclick="clickSeat(this)"></li>
        <li class="9" onclick="clickSeat(this)"></li>
        <li class="10" onclick="clickSeat(this)"></li>
        <li class="11" onclick="clickSeat(this)"></li>
        <li class="12" onclick="clickSeat(this)"></li>
        <li class="13" onclick="clickSeat(this)"></li>
    </ul>
    <ul id="7">
        <li class="0" onclick="clickSeat(this)"></li>
        <li class="1" onclick="clickSeat(this)"></li>
        <li class="2" onclick="clickSeat(this)"></li>
        <li class="3" onclick="clickSeat(this)"></li>
        <li class="4" onclick="clickSeat(this)"></li>
        <li class="5" onclick="clickSeat(this)"></li>
        <li class="6" onclick="clickSeat(this)"></li>
        <li class="7" onclick="clickSeat(this)"></li>
        <li class="8" onclick="clickSeat(this)"></li>
        <li class="9" onclick="clickSeat(this)"></li>
        <li class="10" onclick="clickSeat(this)"></li>
        <li class="11" onclick="clickSeat(this)"></li>
        <li class="12" onclick="clickSeat(this)"></li>
        <li class="13" onclick="clickSeat(this)"></li>
    </ul>
    <ul id="8">
        <li class="0" onclick="clickSeat(this)"></li>
        <li class="1" onclick="clickSeat(this)"></li>
        <li class="2" onclick="clickSeat(this)"></li>
        <li class="3" onclick="clickSeat(this)"></li>
        <li class="4" onclick="clickSeat(this)"></li>
        <li class="5" onclick="clickSeat(this)"></li>
        <li class="6" onclick="clickSeat(this)"></li>
        <li class="7" onclick="clickSeat(this)"></li>
        <li class="8" onclick="clickSeat(this)"></li>
        <li class="9" onclick="clickSeat(this)"></li>
        <li class="10" onclick="clickSeat(this)"></li>
        <li class="11" onclick="clickSeat(this)"></li>
        <li class="12" onclick="clickSeat(this)"></li>
        <li class="13" onclick="clickSeat(this)"></li>
    </ul>


    <!-- <button id="getStatus">좌석 확인</button> -->

    <script src="/socket.io/socket.io.js"></script>
    <script>
        window.onload = () => {
            // request.open('GET', '/index.html', true);
            // request.send();
            request.open('GET', '/status', true);
            request.send();

            request.onreadystatechange = (e) => {
                if(request.readyState == 4) {
                    if(request.status == 200) {
                        const json = eval('('+request.responseText+')');
                        let seats;
                        // for(let row = 0; row < 9; row ++) {
                        //     seats = document.getElementById(row).children;
                        //     for(let col = 0; col < 14; col ++) {
                                // if(json[row].status[row][col] == 0) {
                                //     seats[col].setAttribute('style', "border-color:white")
                                // } else if(json.status[row][col] == 1) {
                                //     seats[col].setAttribute('style', "background-color:black;")
                                // } else if(json.status[row][col] == 2) {
                                //     seats[col].setAttribute('style', "background-color:lightgrey; border-color:lightgrey;")
                                // }
                        //     }
                        // }
                        console.log(json);
                        var row = 0;
                        seats = document.getElementById(row).children;
                        for(var data of json) {
                            // seats[data.seat] = data.isEmpty;
                            if(data.isEmpty == 0) {
                                seats[data.seat].setAttribute('style', "border-color:white;")
                            } else if(data.isEmpty == 1) {
                                seats[data.seat].setAttribute('style', "background-color:black;")
                            } else if(data.isEmpty == 2) {
                                seats[data.seat].setAttribute('style', "background-color:lightgrey; border-color:lightgrey;")
                            }
                            if(data.line != 0 && data.line != 9 &&(data.seat % 13) == 0 && data.seat != 0) {
                                row ++;
                                seats = document.getElementById(row).children;
                                // console.log(seats);
                            }
                        }
                    }
                }
            }
        }
        const socket = io();
        const request = new XMLHttpRequest;

        socket.on('newSelected', (data) => {
            const seat = document.getElementById(data.row).children;
            seat[data.col].setAttribute('style', 'background-color:lightgrey; border-color:lightgrey');
        })

        function clickSeat(e) {
            const ul = e.parentElement.getAttribute('id');
            const li = e.getAttribute('class');
            const checked = confirm(`${ul} 열 ${li} 번째 좌석을 선택하시겠습니까?`)

            if(checked) {
                request.open('POST', '/select', true);
                request.setRequestHeader('Content-type', 'application/json');
                const data = {
                    row : ul,
                    col : li
                }
                request.send(JSON.stringify(data));

                request.onreadystatechange = (e) => {
                    if(request.readyState == 4) {
                        if(request.status == 200) {
                            var json = eval('('+request.responseText+')');
                            if(json.status == 1) {
                                alert('좌석이 선택되었습니다.');
                                socket.emit('select', {
                                    row : ul,
                                    col : li
                                })
                            } else {
                                alert('이미 선택된 좌석입니다.');
                            }
                        }
                    }
                }
                console.log(request.responseText);
            }
        }
        
        // const getStatus = document.getElementById('getStatus');
        // getStatus.onclick = () => {
        //     request.open('GET', '/status', true);
        //     request.send();

        //     request.onreadystatechange = (e) => {
        //         if(request.readyState == 4) {
        //             if(request.status == 200) {
        //                 // console.log(request.responseText);
        //                 const json = eval('('+request.responseText+')');
        //                 let seats;
        //                 // for(let row = 0; row < 9; row ++) {
        //                 //     seats = document.getElementById(row).children;
        //                 //     for(let col = 0; col < 14; col ++) {
        //                 //         if(json.status[row][col] == 0) {
        //                 //             seats[col].setAttribute('style', "border-color:white")
        //                 //         } else if(json.status[row][col] == 1) {
        //                 //             seats[col].setAttribute('style', "background-color:black;")
        //                 //         } else if(json.status[row][col] == 2) {
        //                 //             seats[col].setAttribute('style', "background-color:lightgrey; border-color:lightgrey;")
        //                 //         }
        //                 //     }
        //                 // }
        //                 console.log(json);
        //             }
        //         }
        //     }
        // }

        // request.open('GET', '/index.html', true);

        // request.send();

        // alert(request.responseText);
    </script>
</body>
</html>